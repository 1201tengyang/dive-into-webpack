### 构建同构应用
同构应用是指写一份代码但可同时在浏览器和服务器中运行的应用。

#### 认识同构应用
现在大多数单页应用的视图都是通过 JavaScript 代码在浏览器端渲染出来的，但在浏览器端渲染的坏处有：

- 搜索引擎无法收录你的网页，因为展示出的数据都是在浏览器端异步渲染出来的，大部分爬虫无法获取到这些数据。
- 对于复杂的单页应用，渲染过程计算量大，对低端移动设备来说可能会有性能问题，用户能明显感知到首屏的渲染延迟。

为了解决以上问题，有人提出能否将原本只运行在浏览器中的 JavaScript 渲染代码也在服务器端运行，在服务器端渲染出页面的 HTML 后在返回带数据的 HTML 文件。
这样就能让搜索引擎爬虫直接抓取到带数据的 HTML，同时也能降低首屏渲染时间。
由于 Nodejs 的流行和成熟，以及虚拟 DOM 提出与实现，使这个假设成为可能。

实际上现在主流的前端框架都支持同构，包括 React、Vue2、Angular2，其中最先支持也是最成熟的同构方案是 React。
由于 React 使用者更多，它们之间又很相似，本节只介绍如何用 Webpack 构建 React 同构应用。

同构应用运行原理的核心在于虚拟 DOM，虚拟 DOM 的意思是不直接操作 DOM 而是通过 JavaScript Object 去描述原本的 DOM 结构，在需要更新 DOM 是不直接操作 DOM 而是通过更新 JavaScript Object 后再映射成 DOM 操作。
虚拟 DOM 的优点在于：

- 因为操作 DOM 是高耗时的操作，尽量减少 DOM 能优化网页性能。而 DOM Diff 算法能找出2个不同 Object 的最小差异，得出最小 DOM 操作。
- 虚拟 DOM 的在渲染的时候不仅仅可以通过操作 DOM 树来表示出结果，也能有其它的表示方式，例如把虚拟 DOM 渲染成字符串(服务器端渲染)，或者渲染成 App 原生的 UI 组件( React Native)。

以 React 为例，核心模块 `react` 负责管理 React 组件的生命周期，而具体的渲染工作可以交给 `react-dom` 模块来负责。
`react-dom` 在渲染虚拟 DOM 时有2中方式可选：

- 通过 `render()` 操作浏览器 DOM 树来表示出结果。
- 通过 `renderToString()` 计算出表示虚拟 DOM 的字符串。

#### 解决方案
解决同构应用的最终目的是从项目源码中构建出2份 JavaScript 代码，一份用于在浏览器端运行，一份用于在 Nodejs 环境中运行渲染出 HTML。

接下来教你一步步修改[3.4使用React框架](3.4使用React框架.md)中的 React 项目，为它增加构建同构应用的功能。

### 构建 Npm 模块

#### 认识 Npm
[Npm](https://www.npmjs.com) 是目前最大的 JavaScript 模块仓库，里面有来自全世界开发者上传的可复用模块。
虽然大多数情况下你都是这些开放模块的使用者，但有时候你也许会成为贡献者，开发一个模块上传到 Npm 仓库。

发布到 Npm 仓库的模块有以下几个特点：

- 每个模块根目录下都必须有一个描述该模块的 `package.json` 文件。该文件描述了模块的入口文件是哪个，该模块又依赖哪些模块等。想深入了解可以阅读文章 [package.json文件](http://javascript.ruanyifeng.com/nodejs/packagejson.html)。
- 模块中的文件以 JavaScript 文件为主，但不限于 JavaScript 文件。例如一个 UI 组件模块可能同时需要 JavaScript、CSS、图片文件等。
- 模块中的代码大多采用模块化规范，因为你的这个模块可能依赖其它模块，而且别的模块又可能依赖你的这个模块。因为目前支持比较广泛的是 CommonJS 模块化规范，上传到 Npm 仓库的代码最好遵守该规范。

#### 抛出问题
Webpack 不仅可用于构建运行的应用，也可用于构建上传到 Npm 的模块。
接下来用教大家如何用 Webpack 构建一个可上传的 Npm 仓库的 React 组件，具体要求如下：

1. 源代码采用 ES6 写，但发布到 Npm 仓库的需要是 ES5 的，并且遵守 CommonJS 模块化规范。由于代码要被转换，请同时提供 Source Map 以发布调试。
2. 发布出去的组件的代码不能包含其依赖的组件的代码，而是让用户可选择性的去安装。具体是指不能包含依赖的 React 库的代码。这样做的目的是在其它组件也依赖 React 库时，防止 React 库的代码被重复打包。
3. 该 UI 组件依赖的其它资源文件比如 CSS 文件也需要包含在发布的模块里。
4. 尽量减少冗余代码，减少发布出去的组件的代码文件大小。

在开始前先看下最终发布到 Npm 仓库的模块的目录结构：
```
node_modules/hello-webpack
├── lib
│   ├── index.css (组件所有依赖的 CSS 都在这个文件中)
│   ├── index.css.map
│   ├── index.js (符合 CommonJS 模块化规范的ES5 代码)
│   └── index.js.map
├── src (ES6 源码)
│   ├── index.css
│   └── index.js
└── package.json (模块描述文件)
```

由于本节的重点不在于 React 而在于 Webpack，所以写一个最简单的 React 组件，`src/index.js` 内容如下：
```jsx
import React, { Component } from 'react';
import './index.css';

// 导出该组件供给其它模块使用
export default class HelloWebpack extends Component {
  render() {
    return <h1 className="hello-component">Hello,Webpack</h1>
  }
}
```

要使用该模块时只需要这样：
```jsx
// 通过 ES6 语法导入
import HelloWebpack from 'hello-webpack';

// 或者通过 ES5 语法导入
var HelloWebpack = require('hello-webpack');

// 使用 react-dom 渲染
render(<HelloWebpack/>);
```

#### 使用 Webpack 构建 Npm 模块
接下来用 Webpack 一条条来解决上面抛出问题的要求。

对于要求1，可以这样做到：

- 使用 babel-loader 把 ES6 代码转换成 ES5 的代码。
- 通过开启 `devtool: 'source-map'` 输出 Source Map 以发布调试。
- 设置 `output.libraryTarget='commonjs2'` 使输出的代码符合CommonJS 模块化规范。CommonJS 模块化规范。

相关的 Webpack 配置代码如下：
```js
module.exports = {
  output: {
    // 输出的代码符合 CommonJS 模块化规范
    libraryTarget: 'commonjs2',
  },
  // 输出 Source Map
  devtool: 'source-map',
};
```

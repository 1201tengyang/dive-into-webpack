### 自动刷新与模块热替换
在开发阶段，修改源码是不可避免的操作。
对于开发网页来说，要想看到修改后的效果，需要刷新浏览器让其重新运行最新的代码才行。
虽然这相比于开发原生 iOS 和 Android 应用来说要方便很多，因为那需要重新编译这个项目再运行，但我们可以把这个体验优化的更好。
借助自动化的手段，可以把这些重复的操作交给代码去帮我们完成，在监听到本地源码文件发生变化时，自动重新构建出可运行的代码后再控制浏览器刷新。

Webpack 把这些功能都内置了，并且还提供多种方案可选。

#### 文件监听
文件监听是在发现源码文件发生变化时，自动重新构建出新的输出文件。

Webpack 官方提供了两大模块，一个是核心的 [webpack](https://www.npmjs.com/package/webpack)，一个是在[1.6 使用DevServer](../1入门/1.6使用DevServer.md) 中提到的 [webpack-dev-server](https://www.npmjs.com/package/webpack-dev-server) 扩展模块。
文件监听功能是 webpack 模块所带有的。

在[2.7 其它配置项](../2配置/2.7其它配置项.md) 中曾介绍过 Webpack 支持文件监听相关的配置项如下：
```js
module.export = {
  // 只有在开启监听模式时，watchOptions 才有意义
  // 默认为 false，也就是不开启
  watch: true,
  // 监听模式运行时的参数
  // 在开启监听模式时，才有意义
  watchOptions: {
    // 不监听的文件或文件夹，支持正则匹配
    // 默认为空
    ignored: /node_modules/,
    // 监听到变化发生后等 300ms 再去执行动作，截流，
    // 防止文件更新太快导致重新编译频率太快。默认 300ms 
    aggregateTimeout: 300,
    // 判断文件是否发生变化是通过不停的去询问系统指定文件有没有变化实现的
    // 默认每秒问 1000 次
    poll: 1000
  }
}
```
要让 Webpack 开启监听模式，有两种方式：

- 在配置文件 `webpack.config.js` 中设置 `watch: true`。
- 在执行启动 Webpack 命令时，带上 `--watch` 参数，完整命令是 `webpack --watch`。

##### 文件监听工作原理
在 Webpack 中监听一个文件发生变化的原理是定时的去获取这个文件的最后编辑时间，每次都存下最新的最后编辑时间，如果发现当前获取的和最后一次保存的最后编辑时间不一致，就认为该文件发生了变化。
配置项中的 `watchOptions.poll` 就是用于控制定时检查的周期，具体含义是每秒检查多少次。

当发现某个文件发生了变化时，并不会立刻告诉监听者，而是先缓存起来，收集一段时间的变化后，再一次性告诉监听者。
配置项只的 `watchOptions.aggregateTimeout` 就是用于配置这个等待时间。
这样做的目的是因为我们在编辑代码的过程中可能会高频的输入文字导致文件变化的事件高频的发生，如果每发生一次就重新执行构建就会让构建卡死。

对于多个文件来说，原理相似，只不过会对列表中的每一个文件都定时的执行检查。
但是这个需要监听的文件列表是怎么确定的呢？
默认情况下 Webpack 会从配置的 Entry 文件出发，递归解析出 Entry 文件所依赖的文件，把这些依赖的文件都加入到监听列表中去。
可见 Webpack 这一点还是做的很智能的，不是粗暴的直接监听项目目录下的所有文件。

由于保存文件的路径和最后编辑时间需要占用内存，定时检查周期检查需要占用 CPU，所以需要减少需要监听的文件数量和降低检查频率。

##### 优化文件监听性能
在明白文件监听工作原理后，就好分析如何优化文件监听性能了。

开启监听模式时，默认情况下会监听配置的 Entry 文件和所有配置的 Entry 文件递归依赖的文件。
在这些文件中会有很多文件存在于 `node_modules` 下，因为如今的 Web 项目会依赖大量的第三方模块。
在大多数情况下我们都不可能去编辑 `node_modules` 下的文件，而是编辑自己建立的源码文件。
所以一个很大的优化点就是忽略掉 `node_modules` 下的文件，不监听它们。相关配置如下：
```js
module.export = {
  // ...
  watchOptions: {
    // 不监听的 node_modules 目录下的文件
    ignored: /node_modules/,
  }
}
```
采用这种方法优化后，你的 Webpack 消耗的内存和 CPU 将会大大降低。

> 有时你可能会觉得 node_modules 目录下的第三方模块有 bug，想修改下 bug 在自己的项目中试试。
> 在这种情况下使用了忽略掉 node_modules 目录下的文件优化后，你需要重启构建以看到最新效果。
> 但这种情况毕竟是非常少见的。

除了忽略掉部分文件的优化外，还有如下两种方法：

- `watchOptions.aggregateTimeout` 值越大性能越好，因为这能降低重新构建的频率。
- `watchOptions.poll` 值越小越好，因为这能降低检查的频率。

但两种优化方法的后果是会让你感觉到监听模式的反应和灵敏度降低了。

#### 自动刷新浏览器
